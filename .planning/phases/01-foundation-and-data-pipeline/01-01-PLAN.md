---
phase: 01-foundation-and-data-pipeline
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - pixi.toml
  - pyproject.toml
  - src/classifier_training/__init__.py
  - .pre-commit-config.yaml
  - .gitignore
  - pytest.ini
autonomous: true

must_haves:
  truths:
    - "`pixi install` completes without error on osx-arm64"
    - "`pixi run lint` exits 0 on the src/ directory (empty package passes ruff)"
    - "`pixi run typecheck` exits 0 on the empty src/ package"
    - "`pixi run test` exits 0 (no tests yet, but pytest discovers and reports 0 collected)"
    - "`pixi run python -c 'import classifier_training'` succeeds — editable install works"
  artifacts:
    - path: "pixi.toml"
      provides: "Workspace definition with conda-forge channel, osx-arm64+linux-64 platforms, all deps, tasks"
      contains: "conda-forge"
    - path: "pyproject.toml"
      provides: "flit_core build backend, ruff rules (E/W/F/I/N/UP/B/SIM/S/A/C4/RUF), mypy strict config with third-party overrides"
      contains: "flit_core"
    - path: "src/classifier_training/__init__.py"
      provides: "Package root with __version__ for flit_core"
      contains: "__version__"
    - path: ".pre-commit-config.yaml"
      provides: "trailing-whitespace, end-of-file-fixer, check-yaml, check-added-large-files, check-merge-conflict, detect-private-key, ruff, ruff-format"
      contains: "ruff-pre-commit"
  key_links:
    - from: "pyproject.toml"
      to: "src/classifier_training/__init__.py"
      via: "flit_core editable install reads __version__ from __init__.py"
      pattern: "classifier-training.*editable"
    - from: "pixi.toml"
      to: "pyproject.toml"
      via: "pypi-dependencies editable path install"
      pattern: "path = \".\", editable = true"
---

<objective>
Create the complete project scaffold: pixi environment, flit_core package with src layout, ruff + mypy configuration, pre-commit hooks, and pytest integration. No application code yet — only infrastructure.

Purpose: Everything in subsequent plans depends on this scaffold. An importable, lintable, type-checkable package must exist before any source files are written.
Output: Working pixi environment with `classifier_training` package installed in editable mode; all tooling tasks operational.
</objective>

<execution_context>
@/Users/ortizeg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ortizeg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-data-pipeline/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: pixi.toml and project root files</name>
  <files>
    pixi.toml
    .gitignore
  </files>
  <action>
Create `pixi.toml` in the project root. Mirror the sibling repo structure exactly, adapting for this project.

Required content:
```toml
[workspace]
name = "classifier-training"
version = "0.1.0"
description = "Basketball jersey number classifier training"
authors = ["Enrique G. Ortiz <ortizeg@gmail.com>"]
channels = ["conda-forge"]
platforms = ["osx-arm64", "linux-64"]

[tasks]
test = "pytest"
test-cov = "pytest --cov=src --cov-report=term --cov-report=xml -v"
lint = "ruff check ."
format = "ruff format ."
format-check = "ruff format --check ."
typecheck = "mypy src/"
precommit = "pre-commit run --all-files"

[dependencies]
python = "3.11.*"
lightning = "*"
loguru = "*"
numpy = "<2.0.0"
pydantic = ">=2.0"
pytorch = "*"
torchvision = "*"
pillow = "*"
rich = "*"

[feature.dev.dependencies]
pytest = "*"
pytest-cov = "*"
ruff = "*"
mypy = "*"
pre-commit = "*"

[environments]
default = ["dev"]

[pypi-dependencies]
classifier-training = { path = ".", editable = true }
```

Notes:
- No `hydra-core` in this plan (Phase 4 concern)
- No `wandb` (Phase 4 concern)
- No `opencv` (not needed for data pipeline)
- No `[system-requirements]` cuda block — osx-arm64 primary dev platform; linux-64 CI target
- `[environments] default = ["dev"]` ensures dev tools always available (mirrors sibling)

Create `.gitignore` with standard Python + pixi entries:
```
__pycache__/
*.py[cod]
*.egg-info/
dist/
build/
.eggs/
.pixi/
pixi.lock
*.onnx
*.ckpt
lightning_logs/
outputs/
.coverage
coverage.xml
.mypy_cache/
.ruff_cache/
*.DS_Store
```
  </action>
  <verify>
    `cd "/Users/ortizeg/1Projects/⛹️‍♂️ Next Play/code/classifier-training" && pixi install 2>&1 | tail -5`
    Should show "Project is up to date" or successful install output, no error exit.
  </verify>
  <done>
    `pixi install` completes without error. The `.pixi/` environment directory exists with Python 3.11.
  </done>
</task>

<task type="auto">
  <name>Task 2: pyproject.toml, src package, pre-commit, and pytest config</name>
  <files>
    pyproject.toml
    src/classifier_training/__init__.py
    .pre-commit-config.yaml
    pytest.ini
  </files>
  <action>
Create `pyproject.toml`. Mirror the sibling repo's ruff and mypy configuration exactly, adapted for this package:

```toml
[build-system]
requires = ["flit_core >=3.2,<4"]
build-backend = "flit_core.buildapi"

[project]
name = "classifier_training"
version = "0.0.1"
description = "Basketball jersey number classifier training"
authors = [{name = "Enrique G. Ortiz", email = "ortizeg@gmail.com"}]
license = {text = "Apache-2.0"}
dependencies = [
    "lightning",
    "loguru",
    "numpy<2.0.0",
    "pydantic>=2.0",
    "torch",
    "torchvision",
    "Pillow",
    "rich",
]

[tool.ruff]
target-version = "py311"
line-length = 88

[tool.ruff.lint]
select = [
    "E",    # pycodestyle errors
    "W",    # pycodestyle warnings
    "F",    # pyflakes
    "I",    # isort
    "N",    # pep8-naming
    "UP",   # pyupgrade
    "B",    # bugbear
    "SIM",  # simplify
    "S",    # bandit (security)
    "A",    # builtins
    "C4",   # comprehensions
    "RUF",  # ruff-specific
]
ignore = ["N812"]

[tool.ruff.lint.per-file-ignores]
"tests/**" = ["S101"]

[tool.ruff.lint.isort]
known-first-party = ["classifier_training"]

[tool.mypy]
python_version = "3.11"
strict = true
warn_return_any = true
warn_unused_configs = true

[[tool.mypy.overrides]]
module = [
    "torch.*",
    "torchvision.*",
    "lightning.*",
    "pydantic.*",
    "PIL.*",
    "loguru.*",
    "numpy.*",
    "rich.*",
]
ignore_missing_imports = true
```

Create `src/classifier_training/__init__.py`:
```python
"""Classifier training framework for basketball jersey number recognition."""

__version__ = "0.0.1"
```

Note: flit_core requires `__version__` in `__init__.py`. Keep it in sync with `pyproject.toml:project.version = "0.0.1"`.

Create `.pre-commit-config.yaml` (mirror sibling exactly):
```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ['--maxkb=5000']
      - id: check-merge-conflict
      - id: detect-private-key

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.0
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
      - id: ruff-format
```

Create `pytest.ini`:
```ini
[pytest]
testpaths = tests
addopts = -v
```
  </action>
  <verify>
    Run all four verification commands in sequence:
    1. `cd "/Users/ortizeg/1Projects/⛹️‍♂️ Next Play/code/classifier-training" && pixi run python -c "import classifier_training; print(classifier_training.__version__)"` — must print `0.0.1`
    2. `cd "/Users/ortizeg/1Projects/⛹️‍♂️ Next Play/code/classifier-training" && pixi run lint` — must exit 0 (no files to lint beyond __init__.py passes cleanly)
    3. `cd "/Users/ortizeg/1Projects/⛹️‍♂️ Next Play/code/classifier-training" && pixi run typecheck` — must exit 0
    4. `cd "/Users/ortizeg/1Projects/⛹️‍♂️ Next Play/code/classifier-training" && pixi run test` — must exit 0 (0 tests collected is acceptable)
  </verify>
  <done>
    - `import classifier_training` succeeds, prints version `0.0.1`
    - `pixi run lint` exits 0
    - `pixi run typecheck` exits 0
    - `pixi run test` exits 0
    - All four tooling tasks are operational
  </done>
</task>

</tasks>

<verification>
After both tasks complete, the following must all pass:

```bash
cd "/Users/ortizeg/1Projects/⛹️‍♂️ Next Play/code/classifier-training"
pixi run python -c "import classifier_training; print(classifier_training.__version__)"
pixi run lint
pixi run typecheck
pixi run test
```

File existence checks:
- `pixi.toml` contains `channels = ["conda-forge"]`
- `pyproject.toml` contains `flit_core` and `[tool.ruff.lint]`
- `src/classifier_training/__init__.py` contains `__version__ = "0.0.1"`
- `.pre-commit-config.yaml` contains `ruff-pre-commit`
</verification>

<success_criteria>
- `pixi install` completes without error
- `pixi run python -c "import classifier_training"` succeeds
- `pixi run lint` exits 0
- `pixi run typecheck` exits 0
- `pixi run test` exits 0 (0 tests collected)
- All ruff rules (E/W/F/I/N/UP/B/SIM/S/A/C4/RUF) active
- mypy strict mode active with third-party ignore overrides for torch/torchvision/lightning/pydantic/PIL/loguru/numpy
- pre-commit hooks cover: trailing-whitespace, end-of-file-fixer, check-yaml, check-added-large-files, check-merge-conflict, detect-private-key, ruff, ruff-format
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-data-pipeline/01-01-SUMMARY.md` following the summary template.
</output>
