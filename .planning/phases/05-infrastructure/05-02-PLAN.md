---
phase: 05-infrastructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/lint.yml
  - .github/workflows/test.yml
  - .github/workflows/release.yml
  - .github/ISSUE_TEMPLATE/bug_report.yml
  - .github/ISSUE_TEMPLATE/feature_request.yml
  - .github/PULL_REQUEST_TEMPLATE.md
  - .github/CODEOWNERS
autonomous: false

must_haves:
  truths:
    - "Push to any branch triggers lint workflow (format-check, lint, typecheck)"
    - "PR or push to main/develop triggers test workflow with coverage"
    - "Push to main/develop triggers release workflow with semantic release"
    - "Repository has issue templates for bug reports and feature requests"
    - "Repository has a PR template with test plan checklist"
    - "CODEOWNERS assigns @ortizeg to all paths"
    - "develop branch exists and is pushed to origin"
    - "main and develop branches have protection rules configured"
  artifacts:
    - path: ".github/workflows/lint.yml"
      provides: "Lint CI workflow"
      contains: "pixi run format-check"
    - path: ".github/workflows/test.yml"
      provides: "Test CI workflow with coverage"
      contains: "pixi run test-cov"
    - path: ".github/workflows/release.yml"
      provides: "Semantic release workflow"
      contains: "python-semantic-release"
    - path: ".github/ISSUE_TEMPLATE/bug_report.yml"
      provides: "Bug report issue template"
      contains: "Bug Report"
    - path: ".github/ISSUE_TEMPLATE/feature_request.yml"
      provides: "Feature request issue template"
      contains: "Feature Request"
    - path: ".github/PULL_REQUEST_TEMPLATE.md"
      provides: "PR template with checklist"
      contains: "pixi run test"
    - path: ".github/CODEOWNERS"
      provides: "Code ownership rules"
      contains: "@ortizeg"
  key_links:
    - from: ".github/workflows/lint.yml"
      to: "pixi.toml"
      via: "pixi run format-check, pixi run lint, pixi run typecheck"
      pattern: "pixi run (format-check|lint|typecheck)"
    - from: ".github/workflows/test.yml"
      to: "pixi.toml"
      via: "pixi run test-cov"
      pattern: "pixi run test-cov"
    - from: ".github/workflows/release.yml"
      to: "pyproject.toml"
      via: "python-semantic-release reads [tool.semantic_release]"
      pattern: "python-semantic-release"
---

<objective>
Create GitHub Actions CI/CD workflows, repository templates, and gitflow branch setup by porting from the sibling object-detection-training repo with name substitutions.

Purpose: Automate linting, testing, and releases on every push/PR, provide standardized issue/PR templates, and establish gitflow branching with branch protection.
Output: 3 workflow files, 2 issue templates, PR template, CODEOWNERS file, develop branch, branch protection guidance.
</objective>

<execution_context>
@/Users/ortizeg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ortizeg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions CI/CD workflows</name>
  <files>.github/workflows/lint.yml, .github/workflows/test.yml, .github/workflows/release.yml</files>
  <action>
Create `.github/workflows/` directory structure.

**lint.yml** — Port identically from sibling repo. No name changes needed:
- Trigger: `on: [push, pull_request]`
- `CONDA_OVERRIDE_CUDA: "12.1"` env var
- `prefix-dev/setup-pixi@v0.8.1` with `pixi-version: latest` and `cache: true`
- Steps: `pixi run format-check`, `pixi run lint`, `pixi run typecheck`

**test.yml** — Port identically from sibling repo. No name changes needed:
- Trigger: PR/push to `[main, develop]`
- `CONDA_OVERRIDE_CUDA: "12.1"` env var
- `prefix-dev/setup-pixi@v0.8.1` with `pixi-version: latest` and `cache: true`
- Steps: `pixi run test-cov`, codecov upload (`codecov/codecov-action@v4`)

**release.yml** — Port identically from sibling repo. No name changes needed:
- Trigger: push to `[main, develop]`
- Two jobs: `check` (lint + typecheck + test) and `release` (semantic release)
- `check` job: `CONDA_OVERRIDE_CUDA: "12.1"`, pixi setup, lint, typecheck, test
- `release` job: `needs: [check]`, `concurrency: release`, `environment: pypi`
- Permissions: `id-token: write`, `contents: write`
- Checkout with `fetch-depth: 0` and `git reset --hard` to workflow SHA
- `python-semantic-release/python-semantic-release@v10.5.3`
- PyPI publish step (conditional on `released == 'true'`, uses `PYPI_TOKEN` secret)
- GitHub Releases publish step (`python-semantic-release/publish-action@v10.5.3`)

All three workflows use the exact same action versions and patterns as the sibling repo.
  </action>
  <verify>
Verify files exist: `ls .github/workflows/lint.yml .github/workflows/test.yml .github/workflows/release.yml`. Grep for CONDA_OVERRIDE_CUDA in each. Grep release.yml for `python-semantic-release`. Verify YAML syntax: `python -c "import yaml; yaml.safe_load(open('.github/workflows/lint.yml'))"` (repeat for each).
  </verify>
  <done>Three GitHub Actions workflows created: lint (format-check + lint + typecheck on all pushes), test (pytest with coverage on main/develop), release (semantic release with PyPI publish on main/develop).</done>
</task>

<task type="auto">
  <name>Task 2: Create repository templates and CODEOWNERS</name>
  <files>.github/ISSUE_TEMPLATE/bug_report.yml, .github/ISSUE_TEMPLATE/feature_request.yml, .github/PULL_REQUEST_TEMPLATE.md, .github/CODEOWNERS</files>
  <action>
Create `.github/ISSUE_TEMPLATE/` directory.

**bug_report.yml** — Port identically from sibling repo. No changes needed. Contains:
- name: Bug Report, labels: ["bug"]
- Fields: description (required), reproduction steps (required), expected behavior (required), version (required), OS dropdown (required)

**feature_request.yml** — Port identically from sibling repo. No changes needed. Contains:
- name: Feature Request, labels: ["enhancement"]
- Fields: problem statement (required), proposed solution (required), alternatives (optional)

**PULL_REQUEST_TEMPLATE.md** — Port identically from sibling repo. No changes needed. Contains:
- Summary, Changes, Test Plan (pixi run test/lint/format checkboxes), Checklist

**CODEOWNERS** — Port from sibling repo with path substitutions:
- `* @ortizeg` (default)
- `/src/ @ortizeg`
- `/src/classifier_training/conf/ @ortizeg` (not `object_detection_training`)
- `pixi.toml @ortizeg`
- `pyproject.toml @ortizeg`
- `/.github/ @ortizeg`
- `/tests/ @ortizeg`
  </action>
  <verify>
Verify all files exist: `ls .github/ISSUE_TEMPLATE/bug_report.yml .github/ISSUE_TEMPLATE/feature_request.yml .github/PULL_REQUEST_TEMPLATE.md .github/CODEOWNERS`. Grep CODEOWNERS for `classifier_training`. Grep bug_report.yml for `Bug Report`.
  </verify>
  <done>Repository has bug report template, feature request template, PR template with test checklist, and CODEOWNERS assigning @ortizeg to all paths with correct classifier_training references.</done>
</task>

<task type="auto">
  <name>Task 3: Create develop branch and push to origin</name>
  <files></files>
  <action>
Create the `develop` branch from `main` and push it to the remote. The workflows (test.yml, release.yml) trigger on `develop`, semantic release config handles `develop` as a prerelease branch, and branch protection (Task 4) requires the branch to exist.

Steps:
1. `git checkout -b develop` (create from current main HEAD)
2. `git push -u origin develop` (push and set upstream tracking)
3. `git checkout main` (return to main branch)

This must run AFTER Tasks 1-2 so that develop includes the CI/CD files. If Tasks 1-2 have already been committed to main, develop will include those commits.
  </action>
  <verify>
Run `git branch -a | grep develop` to confirm both local and remote develop branches exist. Run `git log develop --oneline -1` to confirm it points to the same commit as main.
  </verify>
  <done>develop branch exists locally and on origin, tracking origin/develop, with the same commit history as main.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 4: Configure branch protection on main and develop</name>
  <files></files>
  <action>
This is a human-action checkpoint. Branch protection must be configured via GitHub Settings UI.

All CI/CD workflows, templates, CODEOWNERS, and the develop branch are now in place. The user must configure branch protection rules in the GitHub web UI.

**For `main` branch:**
1. Go to GitHub repo Settings > Branches > Add branch protection rule
2. Branch name pattern: `main`
3. Enable "Require a pull request before merging"
4. Enable "Require status checks to pass before merging"
5. Add required status checks: `lint`, `test` (from the CI workflows)
6. Enable "Require branches to be up to date before merging"
7. Under "Allow specified actors to bypass required pull requests", add `github-actions[bot]` — this allows semantic release to push version bump commits and tags directly to main without a PR

**For `develop` branch:**
1. Branch name pattern: `develop`
2. Enable "Require status checks to pass before merging"
3. Add required status checks: `lint`, `test`
4. Under "Allow specified actors to bypass required pull requests", add `github-actions[bot]`
  </action>
  <verify>
After configuring, try pushing directly to main — it should be rejected. PRs should show required status checks. Type "done" after configuring branch protection, or "skip" to defer this to later.
  </verify>
  <done>Branch protection rules are configured on both main and develop branches, requiring lint and test status checks to pass, with github-actions[bot] allowed to bypass PR requirements for semantic release.</done>
</task>

</tasks>

<verification>
1. `ls .github/workflows/lint.yml .github/workflows/test.yml .github/workflows/release.yml` — all 3 workflows exist
2. `grep -q 'CONDA_OVERRIDE_CUDA' .github/workflows/lint.yml` — CUDA override set
3. `grep -q 'python-semantic-release' .github/workflows/release.yml` — semantic release configured
4. `grep -q 'fetch-depth: 0' .github/workflows/release.yml` — full history for commit analysis
5. `ls .github/ISSUE_TEMPLATE/bug_report.yml .github/ISSUE_TEMPLATE/feature_request.yml` — issue templates exist
6. `test -f .github/PULL_REQUEST_TEMPLATE.md` — PR template exists
7. `grep -q 'classifier_training' .github/CODEOWNERS` — correct package name in CODEOWNERS
8. `git branch -a | grep -q develop` — develop branch exists locally and on remote
</verification>

<success_criteria>
All 7 files created under .github/. Workflows use CONDA_OVERRIDE_CUDA=12.1, setup-pixi@v0.8.1, and python-semantic-release@v10.5.3. Templates match sibling repo structure. CODEOWNERS references classifier_training paths. develop branch exists on origin. Branch protection configured on main and develop (human-verified).
</success_criteria>

<output>
After completion, create `.planning/phases/05-infrastructure/05-02-SUMMARY.md`
</output>
